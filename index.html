<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Wedding MasterPlan ‚Äî Shared OMNI2 Edition</title>

  <style>
    :root{
      --bg0:#070b14; --bg1:#0b1226;
      --card:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.16);
      --text:#eef2ff;
      --muted:rgba(238,242,255,.72);
      --muted2:rgba(238,242,255,.55);
      --accent:#7c3aed;   /* purple */
      --accent2:#22c55e;  /* green  */
      --warn:#f59e0b;
      --shadow:0 20px 70px rgba(0,0,0,.45);
      --r:18px; --r2:26px;
      --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
      --sans:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:var(--sans);color:var(--text);
      background:
        radial-gradient(1000px 520px at 20% 0%, rgba(124,58,237,.35), transparent 60%),
        radial-gradient(800px 480px at 85% 10%, rgba(34,197,94,.22), transparent 60%),
        radial-gradient(900px 520px at 60% 100%, rgba(245,158,11,.16), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1200px;margin:0 auto;padding:28px 18px 80px}

    /* OMNI2-ish top */
    .top{display:flex;align-items:center;justify-content:space-between;gap:12px;position:sticky;top:0;z-index:50;padding:14px 0;backdrop-filter:blur(10px)}
    .brand{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:999px;border:1px solid var(--stroke);background:rgba(0,0,0,.18)}
    .dot{width:10px;height:10px;border-radius:999px;background:linear-gradient(135deg,var(--accent),#60a5fa);box-shadow:0 0 0 6px rgba(124,58,237,.15)}
    .brand .kicker{font-size:12px;letter-spacing:.18em;opacity:.9}
    .brand b{display:block;font-size:14px;letter-spacing:.3px}
    .brand small{display:block;color:var(--muted2);margin-top:2px;font-size:12px}
    .nav{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:10px;
      padding:10px 14px;border-radius:999px;border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);color:var(--text);cursor:pointer;user-select:none;white-space:nowrap;
      transition:transform .12s ease,border-color .12s ease,background .12s ease;
    }
    .btn:hover{transform:translateY(-1px);border-color:var(--stroke2);background:rgba(255,255,255,.085)}
    .btn.primary{border-color:rgba(124,58,237,.45);background:linear-gradient(135deg,rgba(124,58,237,.95),rgba(96,165,250,.65))}
    .btn.green{border-color:rgba(34,197,94,.45);background:linear-gradient(135deg,rgba(34,197,94,.88),rgba(16,185,129,.55))}
    .btn.danger{border-color:rgba(239,68,68,.45);background:linear-gradient(135deg,rgba(239,68,68,.75),rgba(124,58,237,.30))}

    /* hero */
    .hero{margin-top:12px;border:1px solid var(--stroke);background:linear-gradient(180deg,rgba(255,255,255,.07),rgba(255,255,255,.03));
      border-radius:var(--r2);padding:26px;box-shadow:var(--shadow);position:relative;overflow:hidden}
    .hero:before{content:"";position:absolute;inset:-2px;background:
      radial-gradient(700px 260px at 15% 0%, rgba(124,58,237,.28), transparent 60%),
      radial-gradient(600px 280px at 85% 30%, rgba(34,197,94,.18), transparent 60%);pointer-events:none}
    .badge{display:inline-flex;align-items:center;gap:10px;padding:7px 10px;border-radius:999px;border:1px solid var(--stroke);background:rgba(0,0,0,.18);color:var(--muted);font-size:12px;position:relative}
    .pill{padding:3px 8px;border-radius:999px;background:rgba(245,158,11,.16);border:1px solid rgba(245,158,11,.35);color:rgba(255,240,200,.92);font-weight:800;letter-spacing:.2px}
    h1{margin:14px 0 10px;font-size:clamp(30px,4vw,52px);line-height:1.05;letter-spacing:-.5px;position:relative}
    .sub{color:var(--muted);font-size:15.5px;max-width:72ch;line-height:1.55;position:relative}
    .chips{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px;position:relative}
    .chip{padding:9px 12px;border-radius:999px;border:1px solid var(--stroke);background:rgba(255,255,255,.05);color:var(--muted);font-size:13px}
    .hero-ctas{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px;position:relative}

    /* layout */
    .main{display:grid;grid-template-columns:330px 1fr;gap:18px;margin-top:18px;align-items:start}
    @media (max-width: 980px){ .main{grid-template-columns:1fr} }

    /* sidebar */
    .side{position:sticky;top:86px;border:1px solid var(--stroke);border-radius:var(--r2);background:rgba(255,255,255,.05);box-shadow:var(--shadow);overflow:hidden}
    .sidehead{padding:16px 16px 12px;border-bottom:1px solid var(--stroke);background:rgba(0,0,0,.14)}
    .sidehead b{display:block}
    .sidehead small{color:var(--muted2)}
    .tablist{display:flex;flex-direction:column;padding:10px}
    .tabbtn{
      text-align:left;padding:10px 12px;border-radius:14px;border:1px solid transparent;color:var(--muted);
      display:flex;align-items:center;justify-content:space-between;gap:12px;cursor:pointer;
      transition:background .12s ease,border-color .12s ease,transform .12s ease;user-select:none
    }
    .tabbtn:hover{background:rgba(255,255,255,.06);transform:translateY(-1px)}
    .tabbtn.active{background:linear-gradient(135deg,rgba(124,58,237,.22),rgba(96,165,250,.12));border-color:rgba(124,58,237,.35);color:var(--text)}
    .count{font-family:var(--mono);font-size:12px;color:var(--muted2);padding:2px 8px;border-radius:999px;border:1px solid var(--stroke);background:rgba(0,0,0,.16)}

    /* cards */
    .content{display:flex;flex-direction:column;gap:16px}
    .card{border:1px solid var(--stroke);border-radius:var(--r2);background:rgba(255,255,255,.05);box-shadow:var(--shadow);overflow:hidden}
    .cardh{padding:16px 18px;border-bottom:1px solid var(--stroke);display:flex;align-items:center;justify-content:space-between;gap:12px;background:rgba(0,0,0,.12)}
    .cardh h2{margin:0;font-size:16px;letter-spacing:.2px}
    .cardh p{margin:0;color:var(--muted2);font-size:12.5px}
    .cardb{padding:18px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width: 760px){ .grid2{grid-template-columns:1fr} }
    .kpi{border:1px solid var(--stroke);background:rgba(255,255,255,.04);border-radius:18px;padding:14px}
    .kpi b{display:block;font-size:12px;color:var(--muted2);font-weight:800}
    .kpi span{display:block;margin-top:6px;font-size:20px}
    .kpi small{color:var(--muted2)}
    .divider{height:1px;background:var(--stroke);margin:14px 0}
    .hint{color:var(--muted2);font-size:12.5px;line-height:1.45}
    .mono{font-family:var(--mono)}

    /* inputs */
    label{display:block;font-size:12px;color:var(--muted2);margin-bottom:6px}
    input,textarea,select{
      width:100%;padding:12px 12px;border-radius:14px;border:1px solid var(--stroke);
      background:rgba(0,0,0,.22);color:var(--text);outline:none
    }
    textarea{min-height:110px;resize:vertical}

    /* tables */
    table{width:100%;border-collapse:separate;border-spacing:0 10px}
    th{text-align:left;font-size:12px;color:var(--muted2);font-weight:800;padding:0 10px}
    td{padding:12px 10px;background:rgba(0,0,0,.18);border-top:1px solid var(--stroke);border-bottom:1px solid var(--stroke);color:var(--text)}
    tr td:first-child{border-left:1px solid var(--stroke);border-top-left-radius:14px;border-bottom-left-radius:14px}
    tr td:last-child{border-right:1px solid var(--stroke);border-top-right-radius:14px;border-bottom-right-radius:14px}

    /* small components */
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .tag{display:inline-flex;align-items:center;gap:8px;font-size:12px;color:var(--muted);
      padding:6px 10px;border-radius:999px;border:1px solid var(--stroke);background:rgba(0,0,0,.14)}
    .imggrid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    @media(max-width:900px){.imggrid{grid-template-columns:repeat(2,1fr)}}
    .tile{
      border:1px solid var(--stroke);border-radius:18px;overflow:hidden;background:rgba(0,0,0,.16)
    }
    .tile .ph{
      height:130px;display:flex;align-items:center;justify-content:center;
      background:linear-gradient(135deg, rgba(124,58,237,.20), rgba(34,197,94,.10));
      color:rgba(238,242,255,.80);font-size:12px
    }
    .tile img{width:100%;height:130px;object-fit:cover;display:block}
    .tile .meta{padding:10px}
    .tile .meta b{display:block;font-size:13px}
    .tile .meta small{color:var(--muted2)}
    .pillmini{
      padding:3px 8px;border-radius:999px;border:1px solid var(--stroke);background:rgba(255,255,255,.05);
      color:var(--muted2);font-size:12px;font-family:var(--mono)
    }
    footer{margin-top:26px;color:var(--muted2);text-align:center;font-size:12.5px}

    /* toast */
    #toast{
      position:fixed;left:50%;bottom:22px;transform:translateX(-50%);
      padding:10px 14px;border-radius:999px;border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.35);color:rgba(238,242,255,.92);
      backdrop-filter:blur(10px);box-shadow:0 18px 50px rgba(0,0,0,.5);
      z-index:9999;font-size:13px;opacity:0;transition:opacity .18s ease;pointer-events:none
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="dot"></div>
        <div>
          <div class="kicker">WEDDING</div>
          <b>MasterPlan</b>
          <small>Shared OMNI2 Edition</small>
        </div>
      </div>

      <div class="nav">
        <button class="btn" onclick="openTab('share')">Share</button>
        <button class="btn" onclick="openTab('posts')">Posts</button>
        <button class="btn primary" onclick="openTab('gallery')">Photo Gallery</button>
      </div>
    </div>

    <section class="hero">
      <div class="badge"><span class="pill">NEW ‚Ä¢ Shared</span> <span>Wedding planner you can share with the party &amp; clients</span></div>
      <h1>One link. One hub. Everyone stays aligned.</h1>
      <p class="sub">
        Photos, posts, seating chart, contacts, SMS reminders, suggestions, registry, shopping links,
        playlist, and wedding party profiles ‚Äî all themed and ready to use on GitHub Pages.
      </p>
      <div class="chips">
        <div class="chip">Share Link + Roles</div>
        <div class="chip">Photo Gallery</div>
        <div class="chip">Posts Feed</div>
        <div class="chip">Seating Chart</div>
        <div class="chip">Contacts + SMS</div>
        <div class="chip">Suggestions</div>
        <div class="chip">Registry</div>
        <div class="chip">Shopping Links</div>
        <div class="chip">Playlist</div>
        <div class="chip">Wedding Party Profiles</div>
      </div>
      <div class="hero-ctas">
        <button class="btn primary" onclick="openTab('share')">Create Share Link</button>
        <button class="btn green" onclick="openTab('seating')">Build Seating</button>
        <button class="btn" onclick="openTab('contacts')">Open Contacts</button>
      </div>
    </section>

    <section class="main">
      <!-- SIDEBAR -->
      <aside class="side">
        <div class="sidehead">
          <b>Planner Modules</b>
          <small>Everything in one themed hub</small>
        </div>
        <div class="tablist">
          <div class="tabbtn active" data-tab="share" onclick="openTab('share')"><span>Share</span><span class="count">link</span></div>
          <div class="tabbtn" data-tab="gallery" onclick="openTab('gallery')"><span>Photo Gallery</span><span class="count">pics</span></div>
          <div class="tabbtn" data-tab="party" onclick="openTab('party')"><span>Wedding Party</span><span class="count">team</span></div>
          <div class="tabbtn" data-tab="posts" onclick="openTab('posts')"><span>Posts</span><span class="count">feed</span></div>
          <div class="tabbtn" data-tab="seating" onclick="openTab('seating')"><span>Seating Chart</span><span class="count">map</span></div>
          <div class="tabbtn" data-tab="contacts" onclick="openTab('contacts')"><span>Contacts + SMS</span><span class="count">msg</span></div>
          <div class="tabbtn" data-tab="suggestions" onclick="openTab('suggestions')"><span>Suggestions</span><span class="count">ideas</span></div>
          <div class="tabbtn" data-tab="registry" onclick="openTab('registry')"><span>Registry List</span><span class="count">gift</span></div>
          <div class="tabbtn" data-tab="shopping" onclick="openTab('shopping')"><span>Dress + Shop Links</span><span class="count">buy</span></div>
          <div class="tabbtn" data-tab="playlist" onclick="openTab('playlist')"><span>Playlist</span><span class="count">music</span></div>
          <div class="tabbtn" data-tab="links" onclick="openTab('links')"><span>Links + Photos (All)</span><span class="count">url</span></div>
        </div>
      </aside>

      <!-- CONTENT -->
      <div class="content">

        <!-- SHARE -->
        <div class="card section active" id="tab-share">
          <div class="cardh">
            <div>
              <h2>Share Hub</h2>
              <p>Create a share code so planner + clients/party see the same data</p>
            </div>
            <div class="badge"><span class="pill">Shared</span> <span class="mono" id="shareCodeBadge">‚Äî</span></div>
          </div>
          <div class="cardb">
            <div class="grid2">
              <div>
                <label>Share Code</label>
                <input id="shareCode" placeholder="Click Generate (or type your own)"/>
                <p class="hint">This is how you ‚Äúshare‚Äù a wedding hub. Anyone using the same share code sees the same saved items (via your backend in Step 2).</p>
                <div class="row" style="margin-top:10px">
                  <button class="btn primary" onclick="generateShare()">Generate</button>
                  <button class="btn" onclick="applyShare()">Use Code</button>
                </div>
              </div>
              <div class="kpi">
                <b>Backend Base URL (Step 2)</b>
                <span class="mono" id="baseLbl">Not set</span>
                <div class="divider"></div>
                <label>Base URL</label>
                <input id="baseUrl" placeholder="e.g., https://your-worker.example"/>
                <div class="row" style="margin-top:10px">
                  <button class="btn green" onclick="setBase()">Save Base</button>
                  <button class="btn" onclick="loadAll()">Load Shared Data</button>
                </div>
                <p class="hint">If no backend is set, your data stays local in this browser only.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- GALLERY -->
        <div class="card section" id="tab-gallery">
          <div class="cardh">
            <div>
              <h2>Photo Gallery</h2>
              <p>Add photos + shareable view link (works best with backend in Step 2)</p>
            </div>
            <div class="badge"><span class="pill">Pics</span> <span class="mono" id="galleryCount">0</span></div>
          </div>
          <div class="cardb">
            <div class="grid2">
              <div>
                <label>Add photo (URL) + caption</label>
                <input id="gUrl" placeholder="Paste image URL (Google Drive direct link / Imgur / etc.)"/>
                <div style="height:10px"></div>
                <input id="gCap" placeholder="Caption (e.g., Engagement shoot, Venue tour)"/>
                <div style="height:10px"></div>
                <input id="gLink" placeholder="Optional website link (photographer album, etc.)"/>
                <div class="row" style="margin-top:10px">
                  <button class="btn green" onclick="addItem('gallery')">Add Photo</button>
                  <button class="btn" onclick="copyViewLink('gallery')">Copy View Link</button>
                </div>
                <p class="hint">If you want actual uploads (not URL), Step 2 adds storage (Supabase Storage, Cloudflare R2, etc.).</p>
              </div>
              <div class="kpi">
                <b>View Link</b>
                <span class="mono" id="galleryView">‚Äî</span>
                <div class="divider"></div>
                <div class="hint">Share this with guests to view the gallery.</div>
              </div>
            </div>

            <div class="divider"></div>
            <div class="imggrid" id="galleryGrid"></div>
          </div>
        </div>

        <!-- WEDDING PARTY -->
        <div class="card section" id="tab-party">
          <div class="cardh">
            <div>
              <h2>Wedding Party</h2>
              <p>Photos + names + roles (bridesmaids, groomsmen, etc.)</p>
            </div>
            <div class="badge"><span class="pill">Team</span> <span class="mono" id="partyCount">0</span></div>
          </div>
          <div class="cardb">
            <div class="grid2">
              <div>
                <label>Add member</label>
                <input id="pName" placeholder="Name"/>
                <div style="height:10px"></div>
                <input id="pRole" placeholder="Role (Best Man, Maid of Honor, Bridesmaid...)"/>
                <div style="height:10px"></div>
                <input id="pPhoto" placeholder="Photo URL"/>
                <div style="height:10px"></div>
                <input id="pLink" placeholder="Optional link (Instagram / site)"/>
                <div class="row" style="margin-top:10px">
                  <button class="btn green" onclick="addParty()">Add Member</button>
                  <button class="btn" onclick="copyViewLink('party')">Copy View Link</button>
                </div>
              </div>
              <div class="kpi">
                <b>Tip</b>
                <div class="divider"></div>
                <div class="hint">This page is perfect to share with the wedding party so everyone sees the lineup & roles.</div>
              </div>
            </div>

            <div class="divider"></div>
            <div class="imggrid" id="partyGrid"></div>
          </div>
        </div>

        <!-- POSTS -->
        <div class="card section" id="tab-posts">
          <div class="cardh">
            <div>
              <h2>Posts</h2>
              <p>Updates for clients / party (with optional links + photos)</p>
            </div>
            <div class="badge"><span class="pill">Feed</span> <span class="mono" id="postCount">0</span></div>
          </div>
          <div class="cardb">
            <div class="grid2">
              <div>
                <label>New post</label>
                <input id="postTitle" placeholder="Title (e.g., Dress fitting next Saturday)"/>
                <div style="height:10px"></div>
                <textarea id="postBody" placeholder="Write your update..."></textarea>
                <div style="height:10px"></div>
                <input id="postPhoto" placeholder="Optional photo URL"/>
                <div style="height:10px"></div>
                <input id="postLink" placeholder="Optional link (venue, RSVP form, etc.)"/>
                <div class="row" style="margin-top:10px">
                  <button class="btn green" onclick="addPost()">Publish</button>
                  <button class="btn" onclick="copyViewLink('posts')">Copy View Link</button>
                </div>
              </div>
              <div class="kpi">
                <b>Moderation</b>
                <div class="divider"></div>
                <div class="hint">If you want ‚Äúonly planner can post‚Äù and others can comment, Step 2 adds roles + rules.</div>
              </div>
            </div>
            <div class="divider"></div>
            <div id="postsList"></div>
          </div>
        </div>

        <!-- SEATING -->
        <div class="card section" id="tab-seating">
          <div class="cardh">
            <div>
              <h2>Seating Chart</h2>
              <p>Create tables + assign guests (with optional links/notes)</p>
            </div>
            <div class="badge"><span class="pill">Map</span> <span class="mono" id="seatCount">0</span></div>
          </div>
          <div class="cardb">
            <div class="grid2">
              <div>
                <label>Create a table</label>
                <input id="tName" placeholder="Table name (e.g., Table 1, Family, Friends)"/>
                <input id="tLink" style="margin-top:10px" placeholder="Optional link (notes doc / seating inspo)"/>
                <div class="row" style="margin-top:10px">
                  <button class="btn green" onclick="addTable()">Add Table</button>
                  <button class="btn" onclick="copyViewLink('seating')">Copy View Link</button>
                </div>
                <p class="hint">Then add guest names to the table below.</p>
              </div>
              <div class="kpi">
                <b>Add Guest to Table</b>
                <div class="divider"></div>
                <label>Choose table</label>
                <select id="seatTable"></select>
                <div style="height:10px"></div>
                <input id="seatGuest" placeholder="Guest name"/>
                <input id="seatNote" style="margin-top:10px" placeholder="Optional note (diet, plus-one, etc.)"/>
                <div class="row" style="margin-top:10px">
                  <button class="btn primary" onclick="assignSeat()">Assign</button>
                </div>
              </div>
            </div>
            <div class="divider"></div>
            <div id="seatingView"></div>
          </div>
        </div>

        <!-- CONTACTS + SMS -->
        <div class="card section" id="tab-contacts">
          <div class="cardh">
            <div>
              <h2>Contacts + SMS Reminders</h2>
              <p>Save vendor/guest contacts + tap to text reminders</p>
            </div>
            <div class="badge"><span class="pill">Msg</span> <span class="mono" id="contactCount">0</span></div>
          </div>
          <div class="cardb">
            <div class="grid2">
              <div>
                <label>Add contact</label>
                <input id="cName" placeholder="Name"/>
                <div style="height:10px"></div>
                <input id="cRole" placeholder="Role (Photographer, DJ, Bridesmaid...)"/>
                <div style="height:10px"></div>
                <input id="cPhone" placeholder="Phone (e.g., +1XXXXXXXXXX)"/>
                <div style="height:10px"></div>
                <input id="cEmail" placeholder="Email"/>
                <div style="height:10px"></div>
                <input id="cLink" placeholder="Link (website / Instagram / contract)"/>
                <div class="row" style="margin-top:10px">
                  <button class="btn green" onclick="addContact()">Save Contact</button>
                  <button class="btn" onclick="copyViewLink('contacts')">Copy View Link</button>
                </div>
                <p class="hint"><b>SMS note:</b> GitHub Pages can‚Äôt send SMS directly. This uses the phone‚Äôs SMS app (tap-to-text). Step 2 can add real SMS via Twilio.</p>
              </div>
              <div class="kpi">
                <b>Quick Reminder Message</b>
                <div class="divider"></div>
                <textarea id="smsTemplate" placeholder="e.g., Reminder: fitting at 3pm tomorrow. Please confirm."></textarea>
                <div class="row" style="margin-top:10px">
                  <button class="btn primary" onclick="toast('Saved (local)')">Save Template</button>
                </div>
              </div>
            </div>

            <div class="divider"></div>
            <div id="contactsList"></div>
          </div>
        </div>

        <!-- SUGGESTIONS -->
        <div class="card section" id="tab-suggestions">
          <div class="cardh">
            <div>
              <h2>Wedding Suggestions</h2>
              <p>Let others submit ideas (songs, decor, food, vendors) with links/photos</p>
            </div>
            <div class="badge"><span class="pill">Ideas</span> <span class="mono" id="sugCount">0</span></div>
          </div>
          <div class="cardb">
            <div class="grid2">
              <div>
                <label>Submit a suggestion</label>
                <input id="sBy" placeholder="Your name"/>
                <div style="height:10px"></div>
                <input id="sTitle" placeholder="Suggestion title"/>
                <div style="height:10px"></div>
                <textarea id="sBody" placeholder="Describe the idea..."></textarea>
                <div style="height:10px"></div>
                <input id="sPhoto" placeholder="Optional photo URL"/>
                <div style="height:10px"></div>
                <input id="sLink" placeholder="Optional link (vendor, Pinterest, etc.)"/>
                <div class="row" style="margin-top:10px">
                  <button class="btn green" onclick="addSuggestion()">Submit</button>
                  <button class="btn" onclick="copyViewLink('suggestions')">Copy View Link</button>
                </div>
              </div>
              <div class="kpi">
                <b>Rules</b>
                <div class="divider"></div>
                <div class="hint">To prevent spam and keep ‚Äúplanner approval,‚Äù Step 2 adds roles + approvals server-side.</div>
              </div>
            </div>
            <div class="divider"></div>
            <div id="suggestionsList"></div>
          </div>
        </div>

        <!-- REGISTRY -->
        <div class="card section" id="tab-registry">
          <div class="cardh">
            <div>
              <h2>Registry List</h2>
              <p>Add registry items with links + photos</p>
            </div>
            <div class="badge"><span class="pill">Gift</span> <span class="mono" id="regCount">0</span></div>
          </div>
          <div class="cardb">
            <div class="grid2">
              <div>
                <label>Add item</label>
                <input id="rName" placeholder="Item name"/>
                <div style="height:10px"></div>
                <input id="rStore" placeholder="Store (Amazon, Target, etc.)"/>
                <div style="height:10px"></div>
                <input id="rLink" placeholder="Buy link"/>
                <div style="height:10px"></div>
                <input id="rPhoto" placeholder="Optional photo URL"/>
                <div class="row" style="margin-top:10px">
                  <button class="btn green" onclick="addRegistry()">Add</button>
                  <button class="btn" onclick="copyViewLink('registry')">Copy View Link</button>
                </div>
              </div>
              <div class="kpi">
                <b>Guest-friendly</b>
                <div class="divider"></div>
                <div class="hint">Share the Registry view link so guests can click and shop.</div>
              </div>
            </div>
            <div class="divider"></div>
            <div id="registryList"></div>
          </div>
        </div>

        <!-- SHOPPING LINKS -->
        <div class="card section" id="tab-shopping">
          <div class="cardh">
            <div>
              <h2>Dress + Wedding Shopping Links</h2>
              <p>Save links to buy dresses + wedding related items (with photos)</p>
            </div>
            <div class="badge"><span class="pill">Buy</span> <span class="mono" id="shopCount">0</span></div>
          </div>
          <div class="cardb">
            <div class="grid2">
              <div>
                <label>Add shopping link</label>
                <input id="shTitle" placeholder="Title (e.g., Bridesmaid dress option 1)"/>
                <div style="height:10px"></div>
                <input id="shLink" placeholder="Website link"/>
                <div style="height:10px"></div>
                <input id="shPhoto" placeholder="Optional photo URL"/>
                <div style="height:10px"></div>
                <input id="shNote" placeholder="Notes (size/colors/price)"/>
                <div class="row" style="margin-top:10px">
                  <button class="btn green" onclick="addShopping()">Add</button>
                  <button class="btn" onclick="copyViewLink('shopping')">Copy View Link</button>
                </div>
              </div>
              <div class="kpi">
                <b>Use case</b>
                <div class="divider"></div>
                <div class="hint">Perfect for ‚Äúvote on dresses‚Äù ‚Äî Step 2 can add reactions/likes.</div>
              </div>
            </div>
            <div class="divider"></div>
            <div id="shoppingList"></div>
          </div>
        </div>

        <!-- PLAYLIST -->
        <div class="card section" id="tab-playlist">
          <div class="cardh">
            <div>
              <h2>Playlist Suggestions</h2>
              <p>Add music links + comments (Spotify, Apple Music, YouTube)</p>
            </div>
            <div class="badge"><span class="pill">Music</span> <span class="mono" id="musicCount">0</span></div>
          </div>
          <div class="cardb">
            <div class="grid2">
              <div>
                <label>Add song</label>
                <input id="mBy" placeholder="Your name"/>
                <div style="height:10px"></div>
                <input id="mSong" placeholder="Song + artist"/>
                <div style="height:10px"></div>
                <input id="mLink" placeholder="Music link (Spotify/Apple/YouTube)"/>
                <div style="height:10px"></div>
                <input id="mComment" placeholder="Comment (first dance? party song?)"/>
                <div class="row" style="margin-top:10px">
                  <button class="btn green" onclick="addMusic()">Add</button>
                  <button class="btn" onclick="copyViewLink('playlist')">Copy View Link</button>
                </div>
              </div>
              <div class="kpi">
                <b>Tip</b>
                <div class="divider"></div>
                <div class="hint">Want ‚Äúapprove songs‚Äù + ‚Äúvote up‚Äù? Step 2 adds it with roles.</div>
              </div>
            </div>
            <div class="divider"></div>
            <div id="musicList"></div>
          </div>
        </div>

        <!-- LINKS + PHOTOS (each feature) -->
        <div class="card section" id="tab-links">
          <div class="cardh">
            <div>
              <h2>Links + Photos (Universal)</h2>
              <p>Save any website/photo reference by category (works for every feature)</p>
            </div>
            <div class="badge"><span class="pill">URL</span> <span class="mono" id="linkCount">0</span></div>
          </div>
          <div class="cardb">
            <div class="grid2">
              <div>
                <label>Category</label>
                <select id="uCat">
                  <option>Venue</option><option>Decor</option><option>Florals</option><option>Photography</option>
                  <option>Food</option><option>Dresses</option><option>Suits</option><option>Registry</option>
                  <option>Playlist</option><option>Other</option>
                </select>
                <div style="height:10px"></div>
                <input id="uTitle" placeholder="Title"/>
                <div style="height:10px"></div>
                <input id="uLink" placeholder="Website link"/>
                <div style="height:10px"></div>
                <input id="uPhoto" placeholder="Optional photo URL"/>
                <div style="height:10px"></div>
                <input id="uNote" placeholder="Notes"/>
                <div class="row" style="margin-top:10px">
                  <button class="btn green" onclick="addUniversal()">Save</button>
                  <button class="btn" onclick="copyViewLink('links')">Copy View Link</button>
                </div>
              </div>
              <div class="kpi">
                <b>Why this matters</b>
                <div class="divider"></div>
                <div class="hint">Every feature you asked for supports links + photos. This is the catch-all reference library.</div>
              </div>
            </div>
            <div class="divider"></div>
            <div id="universalList"></div>
          </div>
        </div>

      </div>
    </section>

    <footer>¬© <span id="yr"></span> Wedding MasterPlan ‚Äî Shared OMNI2 Edition</footer>
  </div>

  <div id="toast"></div>

  <script>
    // --------------------
    // Local state (works now)
    // Shared state (works with backend in Step 2)
    // --------------------
    const state = {
      shareCode: localStorage.getItem("wm_shareCode") || "",
      baseUrl: localStorage.getItem("wm_baseUrl") || "",
      gallery: [],
      party: [],
      posts: [],
      seating: { tables: [], assigns: [] },
      contacts: [],
      suggestions: [],
      registry: [],
      shopping: [],
      playlist: [],
      universal: []
    };

    // ---------- UI helpers ----------
    const $ = (id)=>document.getElementById(id);
    function toast(msg){
      const t = $("toast");
      t.textContent = msg;
      t.style.opacity = "1";
      clearTimeout(window.__tt);
      window.__tt = setTimeout(()=>t.style.opacity="0", 1800);
    }
    function safeOpen(url){
      try{ window.open(url, "_blank", "noopener"); } catch(e){}
    }
    function openTab(key){
      document.querySelectorAll(".tabbtn").forEach(b=>b.classList.toggle("active", b.dataset.tab===key));
      document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
      const el = $("tab-"+key);
      if(el) el.classList.add("active");
      location.hash = key;
    }

    // ---------- Share / base ----------
    function randCode(){
      return Math.random().toString(36).slice(2,7).toUpperCase() + "-" + Math.random().toString(36).slice(2,5).toUpperCase();
    }
    function generateShare(){
      $("shareCode").value = randCode();
      applyShare();
    }
    function applyShare(){
      const c = $("shareCode").value.trim();
      if(!c){ toast("Enter a share code"); return; }
      state.shareCode = c;
      localStorage.setItem("wm_shareCode", c);
      $("shareCodeBadge").textContent = c;
      toast("Share code set");
      refreshViewLinks();
      // if backend exists, load shared data
      loadAll();
    }
    function setBase(){
      const b = $("baseUrl").value.trim();
      state.baseUrl = b;
      localStorage.setItem("wm_baseUrl", b);
      $("baseLbl").textContent = b ? b : "Not set";
      toast(b ? "Base URL saved" : "Base URL cleared");
    }

    // view links (works even without backend; backend makes them true shared)
    function viewLinkFor(module){
      const c = state.shareCode || "DEMO";
      // view mode uses query params for filter; backend is what makes data shared
      return location.origin + location.pathname + "?view=" + encodeURIComponent(module) + "&code=" + encodeURIComponent(c);
    }
    function refreshViewLinks(){
      $("galleryView").textContent = viewLinkFor("gallery");
      $("shareCodeBadge").textContent = state.shareCode || "‚Äî";
      $("galleryView").textContent = state.shareCode ? viewLinkFor("gallery") : "Set Share Code";
    }
    async function copyViewLink(module){
      if(!state.shareCode){ toast("Set Share Code first"); openTab("share"); return; }
      const link = viewLinkFor(module);
      try{ await navigator.clipboard.writeText(link); toast("View link copied"); }
      catch(e){ toast("Copy failed ‚Äî select + copy manually"); }
    }

    // ---------- Storage strategy ----------
    // Local fallback: store in localStorage per shareCode
    function localKey(){
      return "wm_local_" + (state.shareCode || "DEMO");
    }
    function saveLocal(){
      const payload = JSON.stringify({
        gallery: state.gallery,
        party: state.party,
        posts: state.posts,
        seating: state.seating,
        contacts: state.contacts,
        suggestions: state.suggestions,
        registry: state.registry,
        shopping: state.shopping,
        playlist: state.playlist,
        universal: state.universal
      });
      localStorage.setItem(localKey(), payload);
    }
    function loadLocal(){
      const raw = localStorage.getItem(localKey());
      if(!raw) return;
      try{
        const d = JSON.parse(raw);
        Object.assign(state, d);
      }catch(e){}
    }

    // Backend shape (Step 2): BASE/save (POST) and BASE/load?code=SHARECODE (GET)
    async function saveRemote(){
      if(!state.baseUrl) return false;
      const base = state.baseUrl.replace(/\/$/,"");
      const payload = {
        code: state.shareCode,
        data: {
          gallery: state.gallery, party: state.party, posts: state.posts,
          seating: state.seating, contacts: state.contacts, suggestions: state.suggestions,
          registry: state.registry, shopping: state.shopping, playlist: state.playlist, universal: state.universal
        }
      };
      try{
        const r = await fetch(base + "/save", {method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(payload)});
        if(!r.ok) throw new Error("bad");
        return true;
      }catch(e){
        toast("Remote save failed (check Base URL)");
        return false;
      }
    }
    async function loadRemote(){
      if(!state.baseUrl) return false;
      if(!state.shareCode) return false;
      const base = state.baseUrl.replace(/\/$/,"");
      try{
        const r = await fetch(base + "/load?code=" + encodeURIComponent(state.shareCode));
        if(!r.ok) throw new Error("bad");
        const j = await r.json();
        if(j && j.data){
          Object.assign(state, j.data);
          return true;
        }
        return false;
      }catch(e){
        return false;
      }
    }

    async function saveAll(){
      saveLocal();
      const ok = await saveRemote();
      if(ok) toast("Saved (shared)");
      else toast("Saved (local)");
      renderAll();
    }
    async function loadAll(){
      loadLocal();
      const ok = await loadRemote();
      if(ok) toast("Loaded shared data");
      renderAll();
    }

    // ---------- Rendering ----------
    function renderGallery(){
      const grid = $("galleryGrid");
      grid.innerHTML = "";
      state.gallery.forEach((it, idx)=>{
        const d = document.createElement("div");
        d.className="tile";
        d.innerHTML = `
          ${it.url ? `<img src="${escapeHtml(it.url)}" alt="photo"/>` : `<div class="ph">No image</div>`}
          <div class="meta">
            <b>${escapeHtml(it.caption || "Photo")}</b>
            <small>${it.link ? `<a class="tag" href="${escapeHtml(it.link)}" target="_blank" rel="noopener">Open link</a>` : `<span class="pillmini">no link</span>`}</small>
            <div class="row" style="margin-top:10px">
              <button class="btn" onclick="removeItem('gallery',${idx})">Remove</button>
            </div>
          </div>`;
        grid.appendChild(d);
      });
      $("galleryCount").textContent = String(state.gallery.length);
    }

    function renderParty(){
      const grid = $("partyGrid");
      grid.innerHTML = "";
      state.party.forEach((m, idx)=>{
        const d = document.createElement("div");
        d.className="tile";
        d.innerHTML = `
          ${m.photo ? `<img src="${escapeHtml(m.photo)}" alt="member"/>` : `<div class="ph">Photo</div>`}
          <div class="meta">
            <b>${escapeHtml(m.name || "Member")}</b>
            <small>${escapeHtml(m.role || "")}</small>
            <div class="row" style="margin-top:10px">
              ${m.link ? `<a class="btn" href="${escapeHtml(m.link)}" target="_blank" rel="noopener">Link</a>` : ``}
              <button class="btn" onclick="removeItem('party',${idx})">Remove</button>
            </div>
          </div>`;
        grid.appendChild(d);
      });
      $("partyCount").textContent = String(state.party.length);
    }

    function renderPosts(){
      const box = $("postsList");
      box.innerHTML = "";
      state.posts.slice().reverse().forEach((p, rIdx)=>{
        const idx = state.posts.length - 1 - rIdx;
        const d = document.createElement("div");
        d.className="kpi";
        d.style.marginBottom="12px";
        d.innerHTML = `
          <b>${escapeHtml(p.title || "Update")}</b>
          <div class="divider"></div>
          <div class="hint">${escapeHtml(p.body || "")}</div>
          <div class="divider"></div>
          <div class="row">
            ${p.photo ? `<a class="btn" href="${escapeHtml(p.photo)}" target="_blank" rel="noopener">Photo</a>` : ``}
            ${p.link ? `<a class="btn" href="${escapeHtml(p.link)}" target="_blank" rel="noopener">Link</a>` : ``}
            <button class="btn danger" onclick="removeItem('posts',${idx})">Delete</button>
          </div>`;
        box.appendChild(d);
      });
      $("postCount").textContent = String(state.posts.length);
    }

    function renderSeating(){
      $("seatCount").textContent = String(state.seating.tables.length);
      const sel = $("seatTable");
      sel.innerHTML = "";
      state.seating.tables.forEach((t, i)=>{
        const opt = document.createElement("option");
        opt.value = String(i);
        opt.textContent = t.name;
        sel.appendChild(opt);
      });

      const view = $("seatingView");
      view.innerHTML = "";
      state.seating.tables.forEach((t, i)=>{
        const card = document.createElement("div");
        card.className="kpi";
        card.style.marginBottom="12px";
        const guests = state.seating.assigns.filter(a=>a.tableIndex===i);
        card.innerHTML = `
          <b>${escapeHtml(t.name)}</b>
          <div class="divider"></div>
          <div class="row" style="margin-bottom:10px">
            ${t.link ? `<a class="btn" href="${escapeHtml(t.link)}" target="_blank" rel="noopener">Table Link</a>` : `<span class="pillmini">no link</span>`}
            <button class="btn" onclick="removeTable(${i})">Remove Table</button>
          </div>
          <div class="hint">${guests.length ? guests.map(g=>`‚Ä¢ ${escapeHtml(g.guest)}${g.note?` ‚Äî <span class="mono">${escapeHtml(g.note)}</span>`:""}`).join("<br/>") : "No guests assigned yet."}</div>
        `;
        view.appendChild(card);
      });
    }

    function renderContacts(){
      $("contactCount").textContent = String(state.contacts.length);
      const list = $("contactsList");
      list.innerHTML = "";
      const tpl = $("smsTemplate").value || "";
      state.contacts.forEach((c, idx)=>{
        const smsBody = encodeURIComponent(tpl || `Reminder for ${c.name || "you"}: `);
        const smsLink = c.phone ? `sms:${encodeURIComponent(c.phone)}?&body=${smsBody}` : "";
        const d = document.createElement("div");
        d.className="kpi";
        d.style.marginBottom="12px";
        d.innerHTML = `
          <b>${escapeHtml(c.name || "Contact")} <span class="pillmini">${escapeHtml(c.role || "")}</span></b>
          <div class="divider"></div>
          <div class="hint">
            ${c.phone ? `üìû <span class="mono">${escapeHtml(c.phone)}</span><br/>` : ""}
            ${c.email ? `‚úâÔ∏è <span class="mono">${escapeHtml(c.email)}</span><br/>` : ""}
          </div>
          <div class="divider"></div>
          <div class="row">
            ${c.link ? `<a class="btn" href="${escapeHtml(c.link)}" target="_blank" rel="noopener">Link</a>` : ``}
            ${smsLink ? `<a class="btn primary" href="${smsLink}">Text Reminder</a>` : `<span class="pillmini">no phone</span>`}
            <button class="btn danger" onclick="removeItem('contacts',${idx})">Delete</button>
          </div>
        `;
        list.appendChild(d);
      });
    }

    function renderSuggestions(){
      $("sugCount").textContent = String(state.suggestions.length);
      const list = $("suggestionsList");
      list.innerHTML = "";
      state.suggestions.slice().reverse().forEach((s, rIdx)=>{
        const idx = state.suggestions.length - 1 - rIdx;
        const d = document.createElement("div");
        d.className="kpi";
        d.style.marginBottom="12px";
        d.innerHTML = `
          <b>${escapeHtml(s.title || "Suggestion")} <span class="pillmini">by ${escapeHtml(s.by || "anon")}</span></b>
          <div class="divider"></div>
          <div class="hint">${escapeHtml(s.body || "")}</div>
          <div class="divider"></div>
          <div class="row">
            ${s.photo ? `<a class="btn" href="${escapeHtml(s.photo)}" target="_blank" rel="noopener">Photo</a>` : ``}
            ${s.link ? `<a class="btn" href="${escapeHtml(s.link)}" target="_blank" rel="noopener">Link</a>` : ``}
            <button class="btn danger" onclick="removeItem('suggestions',${idx})">Delete</button>
          </div>
        `;
        list.appendChild(d);
      });
    }

    function renderRegistry(){
      $("regCount").textContent = String(state.registry.length);
      const list = $("registryList");
      list.innerHTML = "";
      state.registry.forEach((r, idx)=>{
        const d = document.createElement("div");
        d.className="kpi";
        d.style.marginBottom="12px";
        d.innerHTML = `
          <b>${escapeHtml(r.name || "Item")} <span class="pillmini">${escapeHtml(r.store || "")}</span></b>
          <div class="divider"></div>
          <div class="row">
            ${r.photo ? `<a class="btn" href="${escapeHtml(r.photo)}" target="_blank" rel="noopener">Photo</a>` : ``}
            ${r.link ? `<a class="btn primary" href="${escapeHtml(r.link)}" target="_blank" rel="noopener">Buy</a>` : `<span class="pillmini">no link</span>`}
            <button class="btn danger" onclick="removeItem('registry',${idx})">Delete</button>
          </div>
        `;
        list.appendChild(d);
      });
    }

    function renderShopping(){
      $("shopCount").textContent = String(state.shopping.length);
      const list = $("shoppingList");
      list.innerHTML = "";
      state.shopping.forEach((s, idx)=>{
        const d = document.createElement("div");
        d.className="kpi";
        d.style.marginBottom="12px";
        d.innerHTML = `
          <b>${escapeHtml(s.title || "Link")}</b>
          <div class="divider"></div>
          <div class="hint">${escapeHtml(s.note || "")}</div>
          <div class="divider"></div>
          <div class="row">
            ${s.photo ? `<a class="btn" href="${escapeHtml(s.photo)}" target="_blank" rel="noopener">Photo</a>` : ``}
            ${s.link ? `<a class="btn primary" href="${escapeHtml(s.link)}" target="_blank" rel="noopener">Open</a>` : `<span class="pillmini">no link</span>`}
            <button class="btn danger" onclick="removeItem('shopping',${idx})">Delete</button>
          </div>
        `;
        list.appendChild(d);
      });
    }

    function renderPlaylist(){
      $("musicCount").textContent = String(state.playlist.length);
      const list = $("musicList");
      list.innerHTML = "";
      state.playlist.forEach((m, idx)=>{
        const d = document.createElement("div");
        d.className="kpi";
        d.style.marginBottom="12px";
        d.innerHTML = `
          <b>${escapeHtml(m.song || "Song")} <span class="pillmini">by ${escapeHtml(m.by || "anon")}</span></b>
          <div class="divider"></div>
          <div class="hint">${escapeHtml(m.comment || "")}</div>
          <div class="divider"></div>
          <div class="row">
            ${m.link ? `<a class="btn primary" href="${escapeHtml(m.link)}" target="_blank" rel="noopener">Play</a>` : `<span class="pillmini">no link</span>`}
            <button class="btn danger" onclick="removeItem('playlist',${idx})">Delete</button>
          </div>
        `;
        list.appendChild(d);
      });
    }

    function renderUniversal(){
      $("linkCount").textContent = String(state.universal.length);
      const list = $("universalList");
      list.innerHTML = "";
      state.universal.forEach((u, idx)=>{
        const d = document.createElement("div");
        d.className="kpi";
        d.style.marginBottom="12px";
        d.innerHTML = `
          <b>${escapeHtml(u.title || "Reference")} <span class="pillmini">${escapeHtml(u.cat || "Other")}</span></b>
          <div class="divider"></div>
          <div class="hint">${escapeHtml(u.note || "")}</div>
          <div class="divider"></div>
          <div class="row">
            ${u.photo ? `<a class="btn" href="${escapeHtml(u.photo)}" target="_blank" rel="noopener">Photo</a>` : ``}
            ${u.link ? `<a class="btn primary" href="${escapeHtml(u.link)}" target="_blank" rel="noopener">Open</a>` : `<span class="pillmini">no link</span>`}
            <button class="btn danger" onclick="removeItem('universal',${idx})">Delete</button>
          </div>
        `;
        list.appendChild(d);
      });
    }

    function renderAll(){
      renderGallery();
      renderParty();
      renderPosts();
      renderSeating();
      renderContacts();
      renderSuggestions();
      renderRegistry();
      renderShopping();
      renderPlaylist();
      renderUniversal();
      refreshViewLinks();
    }

    // ---------- Add/Remove actions ----------
    function addItem(kind){
      const url = $("gUrl").value.trim();
      const caption = $("gCap").value.trim();
      const link = $("gLink").value.trim();
      if(!url && !caption){ toast("Add image URL or caption"); return; }
      state.gallery.push({url, caption, link});
      $("gUrl").value=""; $("gCap").value=""; $("gLink").value="";
      saveAll();
    }
    function removeItem(kind, idx){
      if(!confirm("Delete this item?")) return;
      state[kind].splice(idx,1);
      saveAll();
    }

    function addParty(){
      const name = $("pName").value.trim();
      const role = $("pRole").value.trim();
      const photo = $("pPhoto").value.trim();
      const link = $("pLink").value.trim();
      if(!name){ toast("Name required"); return; }
      state.party.push({name, role, photo, link});
      $("pName").value=""; $("pRole").value=""; $("pPhoto").value=""; $("pLink").value="";
      saveAll();
    }

    function addPost(){
      const title = $("postTitle").value.trim();
      const body = $("postBody").value.trim();
      if(!title && !body){ toast("Write a title or message"); return; }
      state.posts.push({
        title, body,
        photo: $("postPhoto").value.trim(),
        link: $("postLink").value.trim(),
        ts: Date.now()
      });
      $("postTitle").value=""; $("postBody").value=""; $("postPhoto").value=""; $("postLink").value="";
      saveAll();
    }

    function addTable(){
      const name = $("tName").value.trim();
      if(!name){ toast("Table name required"); return; }
      state.seating.tables.push({name, link: $("tLink").value.trim()});
      $("tName").value=""; $("tLink").value="";
      saveAll();
    }
    function removeTable(i){
      if(!confirm("Remove this table and its assignments?")) return;
      state.seating.tables.splice(i,1);
      state.seating.assigns = state.seating.assigns.filter(a=>a.tableIndex!==i).map(a=>({
        ...a, tableIndex: a.tableIndex > i ? a.tableIndex-1 : a.tableIndex
      }));
      saveAll();
    }
    function assignSeat(){
      const ti = Number($("seatTable").value);
      const guest = $("seatGuest").value.trim();
      if(!guest){ toast("Guest name required"); return; }
      state.seating.assigns.push({tableIndex: ti, guest, note: $("seatNote").value.trim()});
      $("seatGuest").value=""; $("seatNote").value="";
      saveAll();
    }

    function addContact(){
      const name = $("cName").value.trim();
      if(!name){ toast("Name required"); return; }
      state.contacts.push({
        name,
        role: $("cRole").value.trim(),
        phone: $("cPhone").value.trim(),
        email: $("cEmail").value.trim(),
        link: $("cLink").value.trim()
      });
      $("cName").value=""; $("cRole").value=""; $("cPhone").value=""; $("cEmail").value=""; $("cLink").value="";
      saveAll();
    }

    function addSuggestion(){
      const title = $("sTitle").value.trim();
      const body = $("sBody").value.trim();
      if(!title && !body){ toast("Add title or details"); return; }
      state.suggestions.push({
        by: $("sBy").value.trim(),
        title, body,
        photo: $("sPhoto").value.trim(),
        link: $("sLink").value.trim(),
        ts: Date.now()
      });
      $("sBy").value=""; $("sTitle").value=""; $("sBody").value=""; $("sPhoto").value=""; $("sLink").value="";
      saveAll();
    }

    function addRegistry(){
      const name = $("rName").value.trim();
      if(!name){ toast("Item name required"); return; }
      state.registry.push({
        name,
        store: $("rStore").value.trim(),
        link: $("rLink").value.trim(),
        photo: $("rPhoto").value.trim()
      });
      $("rName").value=""; $("rStore").value=""; $("rLink").value=""; $("rPhoto").value="";
      saveAll();
    }

    function addShopping(){
      const title = $("shTitle").value.trim();
      const link = $("shLink").value.trim();
      if(!title && !link){ toast("Add title or link"); return; }
      state.shopping.push({
        title, link,
        photo: $("shPhoto").value.trim(),
        note: $("shNote").value.trim()
      });
      $("shTitle").value=""; $("shLink").value=""; $("shPhoto").value=""; $("shNote").value="";
      saveAll();
    }

    function addMusic(){
      const song = $("mSong").value.trim();
      const link = $("mLink").value.trim();
      if(!song && !link){ toast("Add song or link"); return; }
      state.playlist.push({
        by: $("mBy").value.trim(),
        song, link,
        comment: $("mComment").value.trim()
      });
      $("mBy").value=""; $("mSong").value=""; $("mLink").value=""; $("mComment").value="";
      saveAll();
    }

    function addUniversal(){
      const title = $("uTitle").value.trim();
      const link = $("uLink").value.trim();
      if(!title && !link){ toast("Add title or link"); return; }
      state.universal.push({
        cat: $("uCat").value,
        title, link,
        photo: $("uPhoto").value.trim(),
        note: $("uNote").value.trim()
      });
      $("uTitle").value=""; $("uLink").value=""; $("uPhoto").value=""; $("uNote").value="";
      saveAll();
    }

    // ---------- view-only mode ----------
    // ?view=gallery&code=XXXX shows one module (for guests) + hides editor controls
    function applyViewMode(){
      const p = new URLSearchParams(location.search);
      const view = p.get("view");
      const code = p.get("code");
      if(code){ $("shareCode").value = code; state.shareCode = code; localStorage.setItem("wm_shareCode", code); }
      if(view){
        // minimal UI: jump to module + hide sidebar edits by switching tab
        openTab(view);
        toast("View mode: " + view);
      }
    }

    // ---------- security helpers ----------
    function escapeHtml(s){
      return String(s || "").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    // ---------- init ----------
    (function init(){
      $("yr").textContent = new Date().getFullYear();
      $("baseUrl").value = state.baseUrl || "";
      $("baseLbl").textContent = state.baseUrl ? state.baseUrl : "Not set";
      $("shareCode").value = state.shareCode || "";
      $("shareCodeBadge").textContent = state.shareCode || "‚Äî";

      // default open tab from hash
      const hash = (location.hash || "").replace("#","");
      if(hash) openTab(hash);

      // load local + try remote if configured
      loadAll().then(()=>{
        renderAll();
        refreshViewLinks();
        applyViewMode();
      });
    })();
  </script>
</body>
</html>
